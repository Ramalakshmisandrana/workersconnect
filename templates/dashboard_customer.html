{% extends "base.html" %}

{% block title %}Dashboard - WorkersConnect{% endblock %}

{% block content %}
<div class="dashboard-container">
    <nav class="navbar navbar-expand-lg dashboard-navbar">
        <div class="container-fluid">
            <a class="navbar-brand" href="{{ url_for('index') }}">WorkersConnect</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
                <ul class="navbar-nav align-items-center">
                    <li class="nav-item me-3">
                        <span class="text-muted">Welcome, {{ current_user.full_name }}</span>
                    </li>
                    <li class="nav-item">
                        <a class="btn btn-logout" href="{{ url_for('logout') }}">
                            <i class="fas fa-sign-out-alt me-1"></i>Logout
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    
    <div class="dashboard-content">
        <div class="welcome-card">
            <h1 class="welcome-title">Find Workers Near You</h1>
            <p class="welcome-subtitle">Connect with skilled professionals in your area instantly</p>
            
            <div class="search-box-container">
                <form id="skillSearchForm" class="skill-search-form">
                    <div class="search-input-group">
                        <select id="skillSelect" class="skill-select" name="skill">
                            <option value="">All Services</option>
                            <option value="Electrician">Electrician</option>
                            <option value="Plumber">Plumber</option>
                            <option value="Carpenter">Carpenter</option>
                            <option value="Painter">Painter</option>
                            <option value="AC Technician">AC Technician</option>
                            <option value="Welder">Welder</option>
                            <option value="Mason">Mason</option>
                            <option value="Mobile Repair">Mobile Repair</option>
                            <option value="CCTV Installation">CCTV Installation</option>
                            <option value="RO Service">RO Service</option>
                            <option value="Pest Control">Pest Control</option>
                            <option value="Maid">Maid</option>
                            <option value="Driver">Driver</option>
                            <option value="Beautician">Beautician</option>
                            <option value="Tailor">Tailor</option>
                            <option value="Cook">Cook</option>
                            <option value="Gardener">Gardener</option>
                        </select>
                        <button type="submit" class="btn-search" id="searchBtn">
                            <i class="fas fa-search me-2"></i>
                            <span id="searchBtnText">Search Workers</span>
                        </button>
                    </div>
                </form>
            </div>
            
            <div class="action-buttons">
                <button class="btn-action" id="useLocationBtn">
                    <i class="fas fa-location-crosshairs"></i>
                    <span id="locationBtnText">Use My Location</span>
                </button>
                <a href="{{ url_for('search') }}" class="btn-action">
                    <i class="fas fa-users"></i>
                    Show All Workers
                </a>
            </div>
        </div>
        
        <div class="skills-grid">
            <h3 class="section-title"><i class="fas fa-tools me-2"></i>Browse by Service</h3>
            <div class="row">
                <div class="col-6 col-md-3 mb-3">
                    <a href="{{ url_for('search', skill='Electrician') }}" class="skill-card">
                        <i class="fas fa-bolt"></i>
                        <span>Electrician</span>
                    </a>
                </div>
                <div class="col-6 col-md-3 mb-3">
                    <a href="{{ url_for('search', skill='Plumber') }}" class="skill-card">
                        <i class="fas fa-faucet"></i>
                        <span>Plumber</span>
                    </a>
                </div>
                <div class="col-6 col-md-3 mb-3">
                    <a href="{{ url_for('search', skill='Carpenter') }}" class="skill-card">
                        <i class="fas fa-hammer"></i>
                        <span>Carpenter</span>
                    </a>
                </div>
                <div class="col-6 col-md-3 mb-3">
                    <a href="{{ url_for('search', skill='Painter') }}" class="skill-card">
                        <i class="fas fa-paint-roller"></i>
                        <span>Painter</span>
                    </a>
                </div>
                <div class="col-6 col-md-3 mb-3">
                    <a href="{{ url_for('search', skill='AC Technician') }}" class="skill-card">
                        <i class="fas fa-snowflake"></i>
                        <span>AC Technician</span>
                    </a>
                </div>
                <div class="col-6 col-md-3 mb-3">
                    <a href="{{ url_for('search', skill='Maid') }}" class="skill-card">
                        <i class="fas fa-broom"></i>
                        <span>Maid</span>
                    </a>
                </div>
                <div class="col-6 col-md-3 mb-3">
                    <a href="{{ url_for('search', skill='Driver') }}" class="skill-card">
                        <i class="fas fa-car"></i>
                        <span>Driver</span>
                    </a>
                </div>
                <div class="col-6 col-md-3 mb-3">
                    <a href="{{ url_for('search', skill='Beautician') }}" class="skill-card">
                        <i class="fas fa-spa"></i>
                        <span>Beautician</span>
                    </a>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-md-4 mb-3">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-search"></i>
                    </div>
                    <h5>Search Workers</h5>
                    <p>Find skilled professionals near your location</p>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="feature-card">
                    <div class="feature-icon success">
                        <i class="fas fa-phone"></i>
                    </div>
                    <h5>Direct Call</h5>
                    <p>Call workers directly, no middleman involved</p>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="feature-card">
                    <div class="feature-icon warning">
                        <i class="fas fa-star"></i>
                    </div>
                    <h5>Trusted Workers</h5>
                    <p>All workers are rated and reviewed</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.getElementById('skillSearchForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const skill = document.getElementById('skillSelect').value;
        const btn = document.getElementById('searchBtn');
        const btnText = document.getElementById('searchBtnText');
        
        btnText.innerHTML = '<span class="spinner"></span> Searching...';
        btn.disabled = true;
        
        if ("geolocation" in navigator) {
            navigator.geolocation.getCurrentPosition(
                function(position) {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;
                    let url = `/search?lat=${lat}&lon=${lon}`;
                    if (skill) url += `&skill=${encodeURIComponent(skill)}`;
                    window.location.href = url;
                },
                function(error) {
                    let url = '/search';
                    if (skill) url += `?skill=${encodeURIComponent(skill)}`;
                    window.location.href = url;
                },
                { enableHighAccuracy: true, timeout: 5000, maximumAge: 0 }
            );
        } else {
            let url = '/search';
            if (skill) url += `?skill=${encodeURIComponent(skill)}`;
            window.location.href = url;
        }
    });
    
    document.getElementById('useLocationBtn').addEventListener('click', function() {
        const btn = this;
        const btnText = document.getElementById('locationBtnText');
        
        if ("geolocation" in navigator) {
            btnText.innerHTML = '<span class="spinner"></span> Getting location...';
            btn.disabled = true;
            
            navigator.geolocation.getCurrentPosition(
                function(position) {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;
                    window.location.href = `/search?lat=${lat}&lon=${lon}`;
                },
                function(error) {
                    btnText.textContent = 'Use My Location';
                    btn.disabled = false;
                    
                    let message = 'Unable to get your location. ';
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            message += 'Please allow location access.';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            message += 'Location information unavailable.';
                            break;
                        case error.TIMEOUT:
                            message += 'Request timed out.';
                            break;
                    }
                    alert(message);
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 0
                }
            );
        } else {
            alert('Geolocation is not supported by your browser');
        }
    });
</script>
{% endblock %}
