{% extends "base.html" %}

{% block title %}Register - WorkersConnect{% endblock %}

{% block content %}
<div class="auth-container">
    <div class="auth-card">
        <h1 class="auth-title">Create Account</h1>
        <p class="auth-subtitle">Join WorkersConnect today</p>
        
        <form method="POST" action="{{ url_for('register') }}" id="registerForm">
            <div class="mb-3">
                <label for="full_name" class="form-label">Full Name</label>
                <input type="text" class="form-control" id="full_name" name="full_name" required placeholder="Enter your full name">
            </div>
            
            <div class="mb-3">
                <label for="email" class="form-label">Email</label>
                <input type="email" class="form-control" id="email" name="email" required placeholder="your@email.com">
            </div>
            
            <div class="mb-3">
                <label for="phone" class="form-label">Phone Number</label>
                <div class="input-group">
                    <span class="input-group-text">+91</span>
                    <input type="tel" class="form-control" id="phone" name="phone" required placeholder="9876543210" pattern="[0-9]{10}" maxlength="10">
                </div>
            </div>
            
            <div class="mb-3">
                <label for="password" class="form-label">Password</label>
                <input type="password" class="form-control" id="password" name="password" required placeholder="Create a password" minlength="3">
            </div>
            
            <div class="mb-3">
                <label for="role" class="form-label">I am a</label>
                <select class="form-select" id="role" name="role" required>
                    <option value="">Select your role</option>
                    <option value="customer">Customer (Looking for workers)</option>
                    <option value="worker">Worker (Providing services)</option>
                </select>
            </div>

            <!-- Profile picture -->
            <div class="mb-3" id="profilePicContainer" style="display: none; text-align: center;">
                <label class="form-label">Profile Picture (Optional)</label>
                <div class="avatar-preview mb-3">
                    <div class="avatar-large" id="previewAvatar">?</div>
                </div>
                <input type="file" name="profile_pic" accept="image/*" class="form-control" id="profilePicInput">
                <div class="form-text">Upload a clear photo of yourself</div>
            </div>
            
            <!-- Skills Selector -->
            <div class="mb-3" id="skillsContainer" style="display: none;">
                <label class="form-label">Your Skills <span class="text-muted">(Select all that apply)</span></label>
                <div class="skills-grid">
                    {% set skills = ['Electrician', 'Plumber', 'Carpenter', 'Painter', 'AC Technician', 'Welder', 'Mason', 'Mobile Repair', 'CCTV Installation', 'RO Service', 'Pest Control', 'Maid', 'Driver', 'Beautician', 'Tailor', 'Cook', 'Gardener'] %}
                    {% for skill in skills %}
                    <div class="form-check">
                        <input class="form-check-input skill-checkbox" type="checkbox" value="{{ skill }}" id="skill_{{ loop.index }}">
                        <label class="form-check-label" for="skill_{{ loop.index }}">{{ skill }}</label>
                    </div>
                    {% endfor %}
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="skill_other">
                        <label class="form-check-label" for="skill_other">Other (please specify)</label>
                    </div>
                </div>
                
                <div class="mt-3" id="otherSkillContainer" style="display: none;">
                    <input type="text" class="form-control" id="otherSkillInput" placeholder="Enter your skill (e.g., Appliance Repair, Locksmith)">
                </div>
                
                <input type="hidden" name="skills" id="skillsHidden" value="">
                <div class="form-text">You can select multiple skills</div>
            </div>
            
            <button type="submit" class="btn btn-primary">
                Create Account
            </button>
        </form>
        
        <p class="auth-link">
            Already have an account? <a href="{{ url_for('login') }}">Login here</a>
        </p>
    </div>
</div>
{% endblock %}

{% block styles %}
<style>
    .skills-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 12px;
        margin-top: 10px;
    }
    .form-check-label {
        font-size: 0.95rem;
        cursor: pointer;
    }
</style>
{% endblock %}

{% block scripts %}
<script>
    const roleSelect = document.getElementById('role');
    const skillsContainer = document.getElementById('skillsContainer');
    const otherCheckbox = document.getElementById('skill_other');
    const otherInputContainer = document.getElementById('otherSkillContainer');
    const otherInput = document.getElementById('otherSkillInput');
    const hiddenSkills = document.getElementById('skillsHidden');

    roleSelect.addEventListener('change', function() {
        skillsContainer.style.display = this.value === 'worker' ? 'block' : 'none';
    });

    otherCheckbox.addEventListener('change', function() {
        otherInputContainer.style.display = this.checked ? 'block' : 'none';
        if (!this.checked) otherInput.value = '';
    });

    // Collect selected skills on submit
    document.getElementById('registerForm').addEventListener('submit', function() {
        const selected = [];
        document.querySelectorAll('.skill-checkbox:checked').forEach(cb => {
            if (cb.value && cb.id !== 'skill_other') {
                selected.push(cb.value);
            }
        });
        if (otherCheckbox.checked && otherInput.value.trim()) {
            selected.push(otherInput.value.trim());
        }
        hiddenSkills.value = selected.join(', ');
    });
</script>
<script>
    // Show profile pic upload when worker is selected
    document.getElementById('role').addEventListener('change', function() {
        const isWorker = this.value === 'worker';
        document.getElementById('skillsContainer').style.display = isWorker ? 'block' : 'none';
        document.getElementById('profilePicContainer').style.display = isWorker ? 'block' : 'none';
    });

    // Preview uploaded image
    document.getElementById('profilePicInput')?.addEventListener('change', function(e) {
        if (e.target.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('previewAvatar').innerHTML = `<img src="${e.target.result}" style="width:100%;height:100%;object-fit:cover;border-radius:50%;">`;
            };
            reader.readAsDataURL(e.target.files[0]);
        }
    });
</script>
<style>
    .avatar-preview .avatar-large {
        width: 100px; height: 100px; background: #007bff; color: white;
        border-radius: 50%; display: flex; align-items: center; justify-content: center;
        font-size: 40px; margin: 0 auto; overflow: hidden;
    }
</style>
{% endblock %}